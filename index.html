<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <title>Loki PDF Compressor</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    @keyframes gradient-shift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes glow-pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(74, 222, 128, 0.3), 0 0 40px rgba(74, 222, 128, 0.1); }
      50% { box-shadow: 0 0 40px rgba(74, 222, 128, 0.5), 0 0 80px rgba(74, 222, 128, 0.2); }
    }
    
    @keyframes slide-in {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', sans-serif;
      background: linear-gradient(135deg, #0a1628 0%, #1a3a52 50%, #2d5f3f 100%);
      background-size: 400% 400%;
      animation: gradient-shift 15s ease infinite;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #e0e0e0;
      position: relative;
      overflow-x: hidden;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(74, 222, 128, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(74, 222, 128, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(74, 222, 128, 0.08) 0%, transparent 50%);
      animation: float 20s ease-in-out infinite;
      pointer-events: none;
    }
    
    .noise {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0.03;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    }
    
    .container {
      background: rgba(15, 25, 40, 0.85);
      backdrop-filter: blur(20px) saturate(180%);
      border-radius: 32px;
      padding: 50px;
      max-width: 650px;
      width: 100%;
      box-shadow: 
        0 40px 100px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.05),
        0 0 60px rgba(74, 222, 128, 0.1);
      border: 1px solid rgba(74, 222, 128, 0.15);
      position: relative;
      animation: slide-in 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, #4ade80, transparent);
      opacity: 0.5;
    }
    
    .header {
      text-align: center;
      margin-bottom: 50px;
      animation: slide-in 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.1s backwards;
    }
    
    .logo {
      margin-bottom: 20px;
      display: inline-block;
      position: relative;
    }
    
    .logo img {
      width: 70px;
      height: 70px;
      object-fit: contain;
      filter: drop-shadow(0 0 20px rgba(74, 222, 128, 0.4));
      animation: float 3s ease-in-out infinite;
    }
    
    .logo::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100px;
      height: 100px;
      background: radial-gradient(circle, rgba(74, 222, 128, 0.2) 0%, transparent 70%);
      transform: translate(-50%, -50%);

      animation: glow-pulse 2s ease-in-out infinite;
      pointer-events: none;
    }
    
    h1 {
      color: #4ade80;
      font-size: 38px;
      font-weight: 700;
      margin-bottom: 12px;
      letter-spacing: -1px;
      text-shadow: 0 0 30px rgba(74, 222, 128, 0.3);
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subtitle {
      color: #94a3b8;
      font-size: 15px;
      font-weight: 400;
      letter-spacing: 0.5px;
    }
    
    .upload-area {
      border: 2px dashed rgba(74, 222, 128, 0.3);
      border-radius: 24px;
      padding: 50px 30px;
      text-align: center;
      margin-bottom: 35px;
      cursor: pointer;
      background: rgba(74, 222, 128, 0.03);
      position: relative;
      overflow: hidden;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      animation: slide-in 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.2s backwards;
    }
    
    .upload-area::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(74, 222, 128, 0.1), transparent);
      transition: left 0.6s;
    }
    
    .upload-area:hover::before {
      left: 100%;
    }
    
    .upload-area:hover {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.08);
      transform: translateY(-4px) scale(1.01);
      box-shadow: 0 20px 40px rgba(74, 222, 128, 0.15);
    }
    
    .upload-area.dragover {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.12);
      transform: scale(1.02);
      box-shadow: 0 0 0 4px rgba(74, 222, 128, 0.1);
    }
    
    .upload-icon {
      font-size: 56px;
      margin-bottom: 20px;
      display: inline-block;
      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .upload-area:hover .upload-icon {
      transform: scale(1.1) rotate(5deg);
    }
    
    .upload-text {
      font-size: 17px;
      color: #e2e8f0;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .upload-subtext {
      font-size: 13px;
      color: #64748b;
      font-weight: 400;
    }
    
    .file-info {
      display: none;
      background: linear-gradient(135deg, rgba(74, 222, 128, 0.1) 0%, rgba(74, 222, 128, 0.05) 100%);
      border-radius: 20px;
      padding: 24px;
      margin-bottom: 30px;
      border-left: 4px solid #4ade80;
      position: relative;
      overflow: hidden;
      animation: slide-in 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .file-info::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(74, 222, 128, 0.05));
    }
    
    .file-info.show { display: block; }
    
    .file-name {
      color: #4ade80;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 15px;
    }
    
    .file-size {
      color: #94a3b8;
      font-size: 14px;
      font-weight: 400;
    }
    
    #pdfAnalysis {
      margin-top: 14px;
      font-size: 13px;
      color: #cbd5e1;
      line-height: 1.8;
      font-weight: 400;
    }
    
    .level-selector {
      margin-bottom: 35px;
      animation: slide-in 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.3s backwards;
    }
    
    .level-selector > label {
      display: block;
      margin-bottom: 20px;
      color: #e2e8f0;
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .levels {
      display: flex;
      gap: 12px;
      justify-content: space-between;
    }
    
    .level-option {
      position: relative;
      flex: 1;
    }
    
    .level-option input[type="radio"] {
      position: absolute;
      opacity: 0;
    }
    
    .level-card {
      background: rgba(30, 41, 59, 0.6);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(74, 222, 128, 0.2);
      border-radius: 16px;
      padding: 20px 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      position: relative;
      overflow: visible;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .level-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(74, 222, 128, 0.1) 0%, transparent 100%);
      opacity: 0;
      transition: opacity 0.4s;
    }
    
    .level-card:hover {
      border-color: #4ade80;
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(74, 222, 128, 0.25);
    }
    
    .level-card:hover::before {
      opacity: 1;
    }
    
    .level-option input[type="radio"]:checked + .level-card {
      background: rgba(74, 222, 128, 0.15);
      border-color: #4ade80;
      box-shadow: 0 6px 30px rgba(74, 222, 128, 0.35), inset 0 0 20px rgba(74, 222, 128, 0.1);
      transform: scale(1.02);
    }
    
    @keyframes icon-bounce {
      0%, 100% {
        transform: translateY(0) scale(1) rotate(0deg);
      }
      25% {
        transform: translateY(-8px) scale(1.1) rotate(-5deg);
      }
      50% {
        transform: translateY(-4px) scale(1.05) rotate(3deg);
      }
      75% {
        transform: translateY(-6px) scale(1.08) rotate(-2deg);
      }
    }
    
    @keyframes icon-pulse {
      0%, 100% {
        transform: scale(1);
        filter: drop-shadow(0 0 5px rgba(74, 222, 128, 0.3));
      }
      50% {
        transform: scale(1.15);
        filter: drop-shadow(0 0 15px rgba(74, 222, 128, 0.6));
      }
    }
    
    @keyframes icon-glow {
      0%, 100% {
        text-shadow: 0 0 10px rgba(74, 222, 128, 0.4);
      }
      50% {
        text-shadow: 0 0 20px rgba(74, 222, 128, 0.8), 0 0 30px rgba(74, 222, 128, 0.4);
      }
    }
    
    .level-emoji {
      font-size: 36px;
      margin-bottom: 10px;
      display: inline-block;
      transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      position: relative;
      z-index: 1;
    }
    
    .level-card:hover .level-emoji {
      animation: icon-bounce 0.6s ease-in-out;
    }
    
    .level-option input[type="radio"]:checked + .level-card .level-emoji {
      animation: icon-pulse 2s ease-in-out infinite;
    }
    
    .level-name {
      font-weight: 700;
      color: #4ade80;
      margin-bottom: 5px;
      font-size: 16px;
      letter-spacing: 0.5px;
      position: relative;
      z-index: 1;
    }
    
    .level-quality {
      font-size: 12px;
      color: #94a3b8;
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    
    .compress-btn {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      border: none;
      border-radius: 16px;
      color: #0a1628;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      margin-bottom: 25px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      box-shadow: 0 8px 30px rgba(74, 222, 128, 0.4);
      position: relative;
      overflow: hidden;
      animation: slide-in 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.4s backwards;
    }
    
    .compress-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    
    .compress-btn:hover::before {
      width: 300px;
      height: 300px;
    }
    
    .compress-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 12px 50px rgba(74, 222, 128, 0.5);
    }
    
    .compress-btn:active:not(:disabled) {
      transform: translateY(-1px);
    }
    
    .compress-btn:disabled {
      background: rgba(100, 116, 139, 0.4);
      cursor: not-allowed;
      box-shadow: none;
    }
    
    .compress-btn img {
      vertical-align: middle;
      margin-right: 10px;
      filter: drop-shadow(0 0 8px rgba(0, 0, 0, 0.3));
      transition: all 0.3s;
    }
    
    .compress-btn:not(:disabled) img {
      animation: logo-glow 2s ease-in-out infinite;
    }
    
    @keyframes logo-glow {
      0%, 100% {
        transform: scale(1) rotate(0deg);
        filter: drop-shadow(0 0 8px rgba(74, 222, 128, 0.4));
      }
      50% {
        transform: scale(1.1) rotate(5deg);
        filter: drop-shadow(0 0 16px rgba(74, 222, 128, 0.7));
      }
    }
    
    .loading {
      display: none;
      text-align: center;
      padding: 30px;
      animation: slide-in 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .loading.show { display: block; }
    
    .spinner {
      border: 4px solid rgba(74, 222, 128, 0.15);
      border-top: 4px solid #4ade80;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 0.8s cubic-bezier(0.5, 0, 0.5, 1) infinite;
      margin: 0 auto 20px;
      position: relative;
    }
    
    .spinner::after {
      content: '';
      position: absolute;
      top: -4px;
      left: -4px;
      right: -4px;
      bottom: -4px;
      border-radius: 50%;
      box-shadow: 0 0 20px rgba(74, 222, 128, 0.3);
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      color: #4ade80;
      font-size: 15px;
      margin-bottom: 12px;
      font-weight: 600;
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: rgba(74, 222, 128, 0.15);
      border-radius: 10px;
      overflow: hidden;
      margin-top: 12px;
      position: relative;
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4ade80, #22c55e, #4ade80);
      background-size: 200% 100%;
      animation: progress-gradient 2s ease infinite;
      width: 0%;
      transition: width 0.3s ease;
      box-shadow: 0 0 15px rgba(74, 222, 128, 0.6);
      border-radius: 10px;
    }
    
    @keyframes progress-gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .log-container {
      display: none;
      background: rgba(10, 15, 30, 0.8);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(74, 222, 128, 0.2);
      border-radius: 16px;
      padding: 20px;
      margin-top: 25px;
      max-height: 220px;
      overflow-y: auto;
      animation: slide-in 0.5s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .log-container.show { display: block; }
    
    .log-container::-webkit-scrollbar { width: 6px; }
    .log-container::-webkit-scrollbar-track {
      background: rgba(74, 222, 128, 0.05);
      border-radius: 10px;
    }
    .log-container::-webkit-scrollbar-thumb {
      background: rgba(74, 222, 128, 0.3);
      border-radius: 10px;
    }
    .log-container::-webkit-scrollbar-thumb:hover {
      background: rgba(74, 222, 128, 0.5);
    }
    
    .log-container h4 {
      color: #4ade80;
      font-size: 13px;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 700;
    }
    
    .log-entry {
      color: #94a3b8;
      font-size: 12px;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      padding: 6px 0;
      border-bottom: 1px solid rgba(74, 222, 128, 0.08);
      animation: slide-in 0.3s ease;
      line-height: 1.5;
    }
    
    .log-entry:last-child { border-bottom: none; }
    .log-entry.success { color: #4ade80; }
    .log-entry.warning { color: #fbbf24; }
    .log-entry.error { color: #ef4444; }
    
    @keyframes build-document {
      0% {
        height: 0;
        opacity: 0;
      }
      50% {
        height: 100%;
        opacity: 0.5;
      }
      100% {
        height: 100%;
        opacity: 1;
      }
    }
    
    @keyframes paper-slide {
      0% {
        transform: translateY(100%) scale(0.8);
        opacity: 0;
      }
      60% {
        transform: translateY(-5%) scale(1.05);
      }
      100% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }
    
    @keyframes page-stack {
      0%, 100% {
        transform: translateY(0px);
      }
      25% {
        transform: translateY(-3px);
      }
      75% {
        transform: translateY(-1px);
      }
    }
    
    .results {
      display: none;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.6) 0%, rgba(30, 41, 59, 0.4) 100%);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 35px;
      border: 1px solid rgba(74, 222, 128, 0.25);
      margin-top: 25px;
      position: relative;
      overflow: hidden;
    }
    
    .results::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(74, 222, 128, 0.1) 0%, transparent 70%);
      animation: float 8s ease-in-out infinite;
    }
    
    .results.show {
      display: block;
      animation: build-document 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    .results h3 {
      color: #4ade80;
      margin-bottom: 30px;
      font-size: 22px;
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.5px;
      animation: paper-slide 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.2s backwards;
    }
    
    .stat-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      border-bottom: 1px solid rgba(74, 222, 128, 0.1);
      transition: all 0.3s;
      opacity: 0;
      animation: paper-slide 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    }
    
    .stat-row:nth-child(2) { animation-delay: 0.3s; }
    .stat-row:nth-child(3) { animation-delay: 0.4s; }
    .stat-row:nth-child(4) { animation-delay: 0.5s; }
    .stat-row:nth-child(5) { animation-delay: 0.6s; }
    .stat-row:nth-child(6) { animation-delay: 0.7s; }
    
    .stat-row:hover {
      padding-left: 10px;
      background: rgba(74, 222, 128, 0.05);
      border-radius: 8px;
      animation: page-stack 0.5s ease;
    }
    
    .stat-row:last-child { border-bottom: none; }
    
    .stat-label {
      color: #cbd5e1;
      font-size: 14px;
      font-weight: 500;
    }
    
    .stat-value {
      color: #4ade80;
      font-weight: 700;
      font-size: 15px;
      text-shadow: 0 0 10px rgba(74, 222, 128, 0.3);
    }
    
    .download-btn {
      width: 100%;
      padding: 18px;
      background: rgba(74, 222, 128, 0.1);
      border: 2px solid #4ade80;
      border-radius: 14px;
      color: #4ade80;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      margin-top: 25px;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      opacity: 0;
      animation: paper-slide 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.8s forwards;
    }
    
    .download-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(74, 222, 128, 0.2), transparent);
      transition: left 0.5s;
    }
    
    .download-btn:hover::before {
      left: 100%;
    }
    
    .download-btn:hover {
      background: rgba(74, 222, 128, 0.2);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(74, 222, 128, 0.3);
    }
    
    input[type="file"] { display: none; }
    
    @media (max-width: 768px) {
      .container { padding: 30px 25px; }
      h1 { font-size: 28px; }
      .levels { grid-template-columns: 1fr; gap: 12px; }
      .level-card { padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="noise"></div>
  <div class="container">
    <div class="header">
      <div class="logo">
        <img src="logo.png" alt="üê∫">
      </div>
      <h1>Loki PDF Compressor</h1>
      <div class="subtitle">Compress your PDFs with precision</div>
    </div>

    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">üìÑ</div>
      <div class="upload-text">Click to browse or drag & drop your PDF here</div>
      <div class="upload-subtext">Supported format: PDF only</div>
    </div>
    <input type="file" id="fileInput" accept=".pdf">

    <div class="file-info" id="fileInfo">
      <div class="file-name" id="fileName"></div>
      <div class="file-size" id="fileSize"></div>
      <div id="pdfAnalysis"></div>
    </div>

    <div class="level-selector">
      <label>Choose Compression Level</label>
      <div class="levels">
        <div class="level-option">
          <input type="radio" name="level" id="light" value="light">
          <label for="light" class="level-card">
            <div class="level-emoji">üåô</div>
            <div class="level-name">Light</div>
            <div class="level-quality">85% Quality</div>
          </label>
        </div>
        <div class="level-option">
          <input type="radio" name="level" id="medium" value="medium" checked>
          <label for="medium" class="level-card">
            <div class="level-emoji">‚ö°</div>
            <div class="level-name">Medium</div>
            <div class="level-quality">70% Quality</div>
          </label>
        </div>
        <div class="level-option">
          <input type="radio" name="level" id="high" value="high">
          <label for="high" class="level-card">
            <div class="level-emoji">üî•</div>
            <div class="level-name">High</div>
            <div class="level-quality">55% Quality</div>
          </label>
        </div>
      </div>
    </div>

    <button class="compress-btn" id="compressBtn" disabled>
      <img src="logo.png" alt="üê∫" style="width: 40px; height: 40px; object-fit: contain;">
      Compress PDF
    </button>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div class="loading-text" id="loadingText">Compressing your PDF...</div>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    </div>

    <div class="log-container" id="logContainer">
      <h4>üìã Processing Log</h4>
      <div id="logEntries"></div>
    </div>

    <div class="results" id="results">
      <h3>‚ú® Compression Complete!</h3>
      <div class="stat-row"><span class="stat-label">Original Size</span><span class="stat-value" id="originalSize">-</span></div>
      <div class="stat-row"><span class="stat-label">Compressed Size</span><span class="stat-value" id="compressedSize">-</span></div>
      <div class="stat-row"><span class="stat-label">Reduction</span><span class="stat-value" id="reduction">-</span></div>
      <div class="stat-row"><span class="stat-label">Images Processed</span><span class="stat-value" id="imagesProcessed">-</span></div>
      <div class="stat-row"><span class="stat-label">Processing Time</span><span class="stat-value" id="time">-</span></div>
      <button class="download-btn" id="downloadBtn">‚¨áÔ∏è Download Compressed PDF</button>
    </div>
  </div>

  <script type="module">
    import init, { compression_level_from_string, init_panic_hook, get_pdf_info, extract_images, reinject_images } from './pkg/loki_pdf.js';

    let selectedFile = null;
    let compressedData = null;

    await init();
    init_panic_hook();

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const compressBtn = document.getElementById('compressBtn');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    const downloadBtn = document.getElementById('downloadBtn');
    const logContainer = document.getElementById('logContainer');
    const logEntries = document.getElementById('logEntries');
    const progressFill = document.getElementById('progressFill');
    const loadingText = document.getElementById('loadingText');

    let progressValue = 0;

    const originalLog = console.log;
    const originalError = console.error;

    console.log = function(...args) {
      originalLog.apply(console, args);
      const message = args.join(' ');
      if (message.includes('wasm streaming') || message.includes('WebAssembly')) return;
      let type = 'info';
      if (message.includes('‚úì') || message.includes('success')) type = 'success';
      else if (message.includes('‚ö†') || message.includes('Warning')) type = 'warning';
      else if (message.includes('‚ùå') || message.includes('Error')) type = 'error';
      addLog(message, type);
    };

    console.error = function(...args) {
      originalError.apply(console, args);
      const message = args.join(' ');
      if (!message.includes('wasm') && !message.includes('WebAssembly')) addLog(message, 'error');
    };

    function addLog(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logEntries.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
      if (logEntries.children.length > 100) logEntries.removeChild(logEntries.firstChild);
      updateProgressFromLog(message);
    }

    function updateProgressFromLog(message) {
      if (message.includes('Extracting images')) updateProgress(20, 'Extracting images...');
      else if (message.includes('Extracted') && message.includes('JPEG')) updateProgress(30, 'Images extracted');
      else if (message.includes('Using') && message.includes('workers')) updateProgress(40, 'Starting workers...');
      else if (message.includes('Worker') && message.includes('complete')) updateProgress(Math.min(90, progressValue + 10), 'Workers completing...');
      else if (message.includes('Reinjecting')) updateProgress(95, 'Reinjecting images...');
      else if (message.includes('Successfully reinjected')) updateProgress(100, 'Complete!');
    }

    function updateProgress(percent, text) {
      progressValue = Math.max(progressValue, percent);
      progressFill.style.width = progressValue + '%';
      loadingText.textContent = text;
    }

    function clearLogs() {
      logEntries.innerHTML = '';
      progressValue = 0;
      progressFill.style.width = '0%';
      loadingText.textContent = 'Compressing your PDF...';
    }

    function forceUIUpdate() { return new Promise(resolve => setTimeout(resolve, 0)); }

    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type === 'application/pdf') handleFile(file);
      else if (file) addLog('Please drop a valid PDF file', 'error');
    });

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file && file.type === 'application/pdf') handleFile(file);
      else if (file) { addLog('Please select a valid PDF file', 'error'); fileInput.value = ''; }
    });

    async function handleFile(file) {
      selectedFile = file;
      fileName.textContent = file.name;
      fileSize.textContent = formatBytes(file.size);
      fileInfo.classList.add('show');
      compressBtn.disabled = false;
      results.classList.remove('show');
      logContainer.classList.remove('show');

      try {
        const buffer = await file.arrayBuffer();
        const uint8Array = new Uint8Array(buffer);
        const info = get_pdf_info(uint8Array);
        document.getElementById('pdfAnalysis').innerHTML = `
          <strong>üìä PDF Analysis:</strong><br>
          Pages: ${info.page_count} | Objects: ${info.total_objects}<br>
          Images: ${info.image_count} (${info.jpeg_images} JPEG)<br>
          Size: ${formatBytes(info.total_size)}
        `;
      } catch (error) { console.error('Analysis error:', error); }
    }

    compressBtn.addEventListener('click', async () => {
      if (!selectedFile) return;
      const levelValue = document.querySelector('input[name="level"]:checked').value;

      try {
        compressBtn.disabled = true;
        loading.classList.add('show');
        results.classList.remove('show');
        logContainer.classList.add('show');
        clearLogs();

        addLog(`üöÄ Starting compression with ${levelValue} level`, 'info');
        await forceUIUpdate();

        const buffer = await selectedFile.arrayBuffer();
        const uint8Array = new Uint8Array(buffer);

        addLog(`‚úì PDF loaded: ${formatBytes(buffer.byteLength)}`, 'success');
        updateProgress(10, 'PDF loaded');
        await forceUIUpdate();

        const startTime = performance.now();
        compressedData = await compressWithWorkers(uint8Array, levelValue);
        const endTime = performance.now();

        addLog('üéâ Compression complete!', 'success');
        await forceUIUpdate();

        const originalSize = uint8Array.length;
        const compressedSize = compressedData.length;
        const reduction = (1.0 - (compressedSize / originalSize)) * 100;
        const savedBytes = originalSize - compressedSize;

        document.getElementById('originalSize').textContent = formatBytes(originalSize);
        document.getElementById('compressedSize').textContent = formatBytes(compressedSize);
        document.getElementById('reduction').textContent = `${reduction.toFixed(2)}% (${formatBytes(savedBytes)})`;
        document.getElementById('time').textContent = `${(endTime - startTime).toFixed(2)} ms`;

        loading.classList.remove('show');
        results.classList.add('show');
        compressBtn.disabled = false;

        addLog(`üíæ Saved ${formatBytes(savedBytes)} (${reduction.toFixed(1)}%)`, 'success');
      } catch (error) {
        addLog(`‚ùå Error: ${error}`, 'error');
        loading.classList.remove('show');
        compressBtn.disabled = false;
      }
    });

    async function compressWithWorkers(uint8Array, levelValue) {
      try {
        addLog('üì¶ Extracting JPEG images...', 'info');
        await forceUIUpdate();

        const images = extract_images(uint8Array);
        if (!images || images.length === 0) {
          addLog('‚ÑπÔ∏è No JPEG images found in PDF', 'info');
          return uint8Array;
        }

        addLog(`‚úì Found ${images.length} JPEG images`, 'success');
        await forceUIUpdate();

        const quality = levelValue === 'light' ? 85 : levelValue === 'medium' ? 70 : 55;
        const scaleFactor = levelValue === 'light' ? 0.85 : levelValue === 'medium' ? 0.65 : 0.45;

        addLog('üîÑ Compressing images in parallel...', 'info');
        await forceUIUpdate();

        const compressedImages = await compressImagesInParallel(images, quality, scaleFactor);
        const totalSaved = compressedImages.reduce((sum, img) => sum + ((img.original_size || 0) - (img.compressed_size || 0)), 0);

        addLog(`‚úì Compressed ${compressedImages.length} images, saved ${Math.round(totalSaved / 1024)} KB`, 'success');
        document.getElementById('imagesProcessed').textContent = compressedImages.length;
        await forceUIUpdate();

        addLog('üì• Reinjecting compressed images...', 'info');
        await forceUIUpdate();

        const result = reinject_images(uint8Array, compressedImages);
        addLog('‚úì PDF reinjection complete', 'success');
        return result;
      } catch (error) {
        addLog(`‚ö†Ô∏è Worker compression failed: ${error}`, 'warning');
        throw error;
      }
    }

    async function compressImagesInParallel(images, quality, scaleFactor) {
      const numWorkers = Math.min(navigator.hardwareConcurrency || 4, images.length, 8);
      const chunkSize = Math.ceil(images.length / numWorkers);
      addLog(`üìä Using ${numWorkers} workers for ${images.length} images`, 'info');
      await forceUIUpdate();

      const promises = [];
      for (let i = 0; i < numWorkers; i++) {
        const chunk = images.slice(i * chunkSize, (i + 1) * chunkSize);
        if (chunk.length === 0) continue;
        promises.push(compressChunkInWorker(chunk, i, quality, scaleFactor));
      }
      const results = await Promise.all(promises);
      return results.flat();
    }

    function compressChunkInWorker(images, workerId, quality, scaleFactor) {
      return new Promise((resolve, reject) => {
        let worker;
        try {
          worker = new Worker('./image-worker.js');
        } catch {
          const workerCode = `
            self.onmessage = async function(e) {
              const { images, quality, scaleFactor, workerId } = e.data;
              const compressed = [];
              try {
                for (let i = 0; i < images.length; i++) {
                  const img = images[i];
                  try {
                    const blob = new Blob([new Uint8Array(img.data)], { type: 'image/jpeg' });
                    const imageBitmap = await createImageBitmap(blob);
                    const newWidth = Math.max(100, Math.floor(imageBitmap.width * scaleFactor));
                    const newHeight = Math.max(100, Math.floor(imageBitmap.height * scaleFactor));
                    const canvas = new OffscreenCanvas(newWidth, newHeight);
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(imageBitmap, 0, 0, newWidth, newHeight);
                    const compressedBlob = await canvas.convertToBlob({ type: 'image/jpeg', quality: quality / 100 });
                    const arrayBuffer = await compressedBlob.arrayBuffer();
                    const uint8Array = new Uint8Array(arrayBuffer);
                    compressed.push({
                      object_id: img.object_id,
                      data: Array.from(uint8Array),
                      width: newWidth,
                      height: newHeight,
                      original_size: img.data.length,
                      compressed_size: uint8Array.length
                    });
                    self.postMessage({ type: 'progress', workerId, current: i + 1, total: images.length, saved: img.data.length - uint8Array.length });
                  } catch (error) {
                    compressed.push({ object_id: img.object_id, data: img.data, width: img.width, height: img.height, original_size: img.data.length, compressed_size: img.data.length });
                  }
                }
                self.postMessage({ type: 'complete', workerId, compressed, totalSaved: compressed.reduce((sum, img) => sum + (img.original_size - img.compressed_size), 0) });
              } catch (error) {
                self.postMessage({ type: 'error', workerId, error: error.message });
              }
            };
          `;
          const blob = new Blob([workerCode], { type: 'application/javascript' });
          worker = new Worker(URL.createObjectURL(blob));
        }

        let savedBytes = 0;
        worker.onmessage = (e) => {
          if (e.data.type === 'progress') {
            savedBytes += e.data.saved || 0;
            if (e.data.current % 5 === 0 || e.data.current === e.data.total) {
              addLog(`üîß Worker ${workerId}: ${e.data.current}/${e.data.total} images (${Math.round(savedBytes / 1024)} KB saved)`, 'success');
            }
          } else if (e.data.type === 'complete') {
            addLog(`‚úì Worker ${workerId}: ${e.data.compressed.length} images, ${Math.round(e.data.totalSaved / 1024)} KB saved`, 'success');
            worker.terminate();
            resolve(e.data.compressed);
          } else if (e.data.type === 'error') {
            addLog(`‚ùå Worker ${workerId} error: ${e.data.error}`, 'error');
            worker.terminate();
            reject(new Error(e.data.error));
          }
        };
        worker.onerror = (error) => {
          addLog(`‚ùå Worker ${workerId} crashed`, 'error');
          worker.terminate();
          reject(error);
        };
        worker.postMessage({ images, quality, scaleFactor, workerId });
      });
    }

    downloadBtn.addEventListener('click', () => {
      if (!compressedData) return;
      const levelValue = document.querySelector('input[name="level"]:checked').value;
      const blob = new Blob([compressedData], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `compressed_${levelValue}_${selectedFile.name}`;
      a.click();
      URL.revokeObjectURL(url);
    });

    function formatBytes(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>
