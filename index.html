<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  <title>Loki PDF Compressor</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a1628 0%, #1a3a52 50%, #2d5f3f 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: #e0e0e0;
    }
    .container {
      background: rgba(15, 25, 40, 0.9);
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(74, 222, 128, 0.2);
    }
    .header { text-align: center; margin-bottom: 40px; }
    .logo {
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    h1 {
      color: #4ade80;
      font-size: 32px;
      margin-bottom: 10px;
      text-shadow: 0 0 20px rgba(74, 222, 128, 0.3);
    }
    .subtitle { color: #94a3b8; font-size: 14px; }
    .upload-area {
      border: 3px dashed rgba(74, 222, 128, 0.4);
      border-radius: 15px;
      padding: 40px;
      text-align: center;
      margin-bottom: 30px;
      transition: all 0.3s ease;
      cursor: pointer;
      background: rgba(74, 222, 128, 0.05);
    }
    .upload-area:hover {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.1);
      transform: translateY(-2px);
    }
    .upload-area.dragover {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.15);
      transform: scale(1.02);
    }
    .upload-icon { font-size: 48px; margin-bottom: 15px; opacity: 0.7; }
    .upload-text { font-size: 16px; color: #94a3b8; margin-bottom: 10px; }
    .upload-subtext { font-size: 12px; color: #64748b; margin-top: 5px; }
    .file-info {
      display: none;
      background: rgba(74, 222, 128, 0.1);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      border-left: 4px solid #4ade80;
    }
    .file-info.show { display: block; }
    .file-name { color: #4ade80; font-weight: bold; margin-bottom: 5px; }
    .file-size { color: #94a3b8; font-size: 14px; }
    #pdfAnalysis { margin-top: 10px; font-size: 12px; color: #94a3b8; line-height: 1.6; }
    .level-selector { margin-bottom: 30px; }
    .level-selector label {
      display: block;
      margin-bottom: 15px;
      color: #cbd5e1;
      font-weight: 500;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .levels { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
    .level-option { position: relative; }
    .level-option input[type="radio"] { position: absolute; opacity: 0; }
    .level-card {
      background: rgba(30, 41, 59, 0.8);
      border: 2px solid rgba(74, 222, 128, 0.3);
      border-radius: 12px;
      padding: 20px 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .level-card:hover {
      border-color: #4ade80;
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(74, 222, 128, 0.2);
    }
    .level-option input[type="radio"]:checked + .level-card {
      background: rgba(74, 222, 128, 0.2);
      border-color: #4ade80;
      box-shadow: 0 0 25px rgba(74, 222, 128, 0.3);
    }
    .level-emoji { font-size: 32px; margin-bottom: 8px; }
    .level-name { font-weight: bold; color: #4ade80; margin-bottom: 5px; font-size: 16px; }
    .level-quality { font-size: 12px; color: #94a3b8; }
    .compress-btn {
      width: 100%;
      padding: 10px;
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
      border: none;
      border-radius: 12px;
      color: #0a1628;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 20px;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 5px 20px rgba(74, 222, 128, 0.3);
    }
    .compress-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(74, 222, 128, 0.4);
    }
    .compress-btn:active:not(:disabled) { transform: translateY(0); }
    .compress-btn:disabled {
      background: rgba(100, 116, 139, 0.5);
      cursor: not-allowed;
      box-shadow: none;
    }
    .compress-btn:not(:disabled) img {
      animation: glow 2s ease-in-out infinite;
    }
    @keyframes glow {
      0%, 100% { 
        transform: scale(1);
        filter: drop-shadow(0 0 5px rgba(74, 222, 128, 0.3));
      }
      50% { 
        transform: scale(1.07);
        filter: drop-shadow(0 0 20px rgba(74, 222, 128, 0.6));
      }
    }
    .loading { display: none; text-align: center; padding: 20px; }
    .loading.show { display: block; }
    .spinner {
      border: 4px solid rgba(74, 222, 128, 0.2);
      border-top: 4px solid #4ade80;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loading-text { color: #4ade80; font-size: 14px; margin-bottom: 10px; }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(74, 222, 128, 0.2);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4ade80, #22c55e);
      width: 0%;
      transition: width 0.3s ease;
      box-shadow: 0 0 10px rgba(74, 222, 128, 0.5);
    }
    .log-container {
      display: none;
      background: rgba(15, 25, 40, 0.95);
      border: 1px solid rgba(74, 222, 128, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      max-height: 200px;
      overflow-y: auto;
    }
    .log-container.show { display: block; }
    .log-container::-webkit-scrollbar { width: 8px; }
    .log-container::-webkit-scrollbar-track { background: rgba(74, 222, 128, 0.1); border-radius: 4px; }
    .log-container::-webkit-scrollbar-thumb { background: rgba(74, 222, 128, 0.4); border-radius: 4px; }
    .log-container::-webkit-scrollbar-thumb:hover { background: rgba(74, 222, 128, 0.6); }
    .log-container h4 {
      color: #4ade80;
      font-size: 14px;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .log-entry {
      color: #94a3b8;
      font-size: 12px;
      font-family: 'Courier New', monospace;
      padding: 4px 0;
      border-bottom: 1px solid rgba(74, 222, 128, 0.1);
    }
    .log-entry:last-child { border-bottom: none; }
    .log-entry.success { color: #4ade80; }
    .log-entry.warning { color: #fbbf24; }
    .log-entry.error { color: #ef4444; }
    .results {
      display: none;
      background: rgba(30, 41, 59, 0.8);
      border-radius: 12px;
      padding: 25px;
      border: 1px solid rgba(74, 222, 128, 0.3);
      margin-top: 20px;
    }
    .results.show { display: block; animation: slideIn 0.5s ease; }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .results h3 { color: #4ade80; margin-bottom: 20px; font-size: 20px; text-align: center; }
    .stat-row {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(74, 222, 128, 0.1);
    }
    .stat-row:last-child { border-bottom: none; }
    .stat-label { color: #94a3b8; font-size: 14px; }
    .stat-value { color: #4ade80; font-weight: bold; font-size: 14px; }
    .download-btn {
      width: 100%;
      padding: 15px;
      background: rgba(74, 222, 128, 0.2);
      border: 2px solid #4ade80;
      border-radius: 10px;
      color: #4ade80;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }
    .download-btn:hover { background: rgba(74, 222, 128, 0.3); transform: translateY(-2px); }
    input[type="file"] { display: none; }
    .footer { text-align: center; margin-top: 30px; color: #64748b; font-size: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo"><img src="logo.png" alt="üê∫" style="width: 60px; height: 60px; object-fit: contain;"></div>
      <h1>Loki PDF Compressor</h1>
    </div>

    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">üìÑ</div>
      <div class="upload-text">Click to browse or drag & drop your PDF here</div>
      <div class="upload-subtext">Supported format: PDF only</div>
    </div>
    <input type="file" id="fileInput" accept=".pdf">

    <div class="file-info" id="fileInfo">
      <div class="file-name" id="fileName"></div>
      <div class="file-size" id="fileSize"></div>
      <div id="pdfAnalysis"></div>
    </div>

    <div class="level-selector">
      <label>Choose Compression Level</label>
      <div class="levels">
        <div class="level-option">
          <input type="radio" name="level" id="light" value="light">
          <label for="light" class="level-card">
            <div class="level-emoji">üåô</div>
            <div class="level-name">Light</div>
            <div class="level-quality">85% Quality</div>
          </label>
        </div>
        <div class="level-option">
          <input type="radio" name="level" id="medium" value="medium" checked>
          <label for="medium" class="level-card">
            <div class="level-emoji">‚ö°</div>
            <div class="level-name">Medium</div>
            <div class="level-quality">70% Quality</div>
          </label>
        </div>
        <div class="level-option">
          <input type="radio" name="level" id="high" value="high">
          <label for="high" class="level-card">
            <div class="level-emoji">üî•</div>
            <div class="level-name">High</div>
            <div class="level-quality">55% Quality</div>
          </label>
        </div>
      </div>
    </div>

    <button class="compress-btn" id="compressBtn" disabled>
      <img src="logo.png" alt="üê∫" style="width: 40px; height: 40px; object-fit: contain; vertical-align: middle;">
      Compress PDF
    </button>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <div class="loading-text" id="loadingText">Compressing your PDF...</div>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    </div>

    <div class="log-container" id="logContainer">
      <h4>üìã Processing Log</h4>
      <div id="logEntries"></div>
    </div>

    <div class="results" id="results">
      <h3>‚ú® Compression Complete!</h3>
      <div class="stat-row"><span class="stat-label">Original Size</span><span class="stat-value" id="originalSize">-</span></div>
      <div class="stat-row"><span class="stat-label">Compressed Size</span><span class="stat-value" id="compressedSize">-</span></div>
      <div class="stat-row"><span class="stat-label">Reduction</span><span class="stat-value" id="reduction">-</span></div>
      <div class="stat-row"><span class="stat-label">Images Processed</span><span class="stat-value" id="imagesProcessed">-</span></div>
      <div class="stat-row"><span class="stat-label">Processing Time</span><span class="stat-value" id="time">-</span></div>
      <button class="download-btn" id="downloadBtn">‚¨áÔ∏è Download Compressed PDF</button>
    </div>
  </div>

  <script type="module">
    import init, { compression_level_from_string, init_panic_hook, get_pdf_info, extract_images, reinject_images } from './pkg/loki_pdf.js';

    let selectedFile = null;
    let compressedData = null;

    await init();
    init_panic_hook();

    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const compressBtn = document.getElementById('compressBtn');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    const downloadBtn = document.getElementById('downloadBtn');
    const logContainer = document.getElementById('logContainer');
    const logEntries = document.getElementById('logEntries');
    const progressFill = document.getElementById('progressFill');
    const loadingText = document.getElementById('loadingText');

    let progressValue = 0;

    const originalLog = console.log;
    const originalError = console.error;

    console.log = function(...args) {
      originalLog.apply(console, args);
      const message = args.join(' ');
      if (message.includes('wasm streaming') || message.includes('WebAssembly')) return;
      let type = 'info';
      if (message.includes('‚úì') || message.includes('success')) type = 'success';
      else if (message.includes('‚ö†') || message.includes('Warning')) type = 'warning';
      else if (message.includes('‚ùå') || message.includes('Error')) type = 'error';
      addLog(message, type);
    };

    console.error = function(...args) {
      originalError.apply(console, args);
      const message = args.join(' ');
      if (!message.includes('wasm') && !message.includes('WebAssembly')) addLog(message, 'error');
    };

    function addLog(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logEntries.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
      if (logEntries.children.length > 100) logEntries.removeChild(logEntries.firstChild);
      updateProgressFromLog(message);
    }

    function updateProgressFromLog(message) {
      if (message.includes('Extracting images')) updateProgress(20, 'Extracting images...');
      else if (message.includes('Extracted') && message.includes('JPEG')) updateProgress(30, 'Images extracted');
      else if (message.includes('Using') && message.includes('workers')) updateProgress(40, 'Starting workers...');
      else if (message.includes('Worker') && message.includes('complete')) updateProgress(Math.min(90, progressValue + 10), 'Workers completing...');
      else if (message.includes('Reinjecting')) updateProgress(95, 'Reinjecting images...');
      else if (message.includes('Successfully reinjected')) updateProgress(100, 'Complete!');
    }

    function updateProgress(percent, text) {
      progressValue = Math.max(progressValue, percent);
      progressFill.style.width = progressValue + '%';
      loadingText.textContent = text;
    }

    function clearLogs() {
      logEntries.innerHTML = '';
      progressValue = 0;
      progressFill.style.width = '0%';
      loadingText.textContent = 'Compressing your PDF...';
    }

    function forceUIUpdate() { return new Promise(resolve => setTimeout(resolve, 0)); }

    uploadArea.addEventListener('click', () => fileInput.click());
    uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('dragover'); });
    uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type === 'application/pdf') handleFile(file);
      else if (file) addLog('Please drop a valid PDF file', 'error');
    });

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file && file.type === 'application/pdf') handleFile(file);
      else if (file) { addLog('Please select a valid PDF file', 'error'); fileInput.value = ''; }
    });

    async function handleFile(file) {
      selectedFile = file;
      fileName.textContent = file.name;
      fileSize.textContent = formatBytes(file.size);
      fileInfo.classList.add('show');
      compressBtn.disabled = false;
      results.classList.remove('show');
      logContainer.classList.remove('show');

      try {
        const buffer = await file.arrayBuffer();
        const uint8Array = new Uint8Array(buffer);
        const info = get_pdf_info(uint8Array);
        document.getElementById('pdfAnalysis').innerHTML = `
          <strong>üìä PDF Analysis:</strong><br>
          Pages: ${info.page_count} | Objects: ${info.total_objects}<br>
          Images: ${info.image_count} (${info.jpeg_images} JPEG)<br>
          Size: ${formatBytes(info.total_size)}
        `;
      } catch (error) { console.error('Analysis error:', error); }
    }

    compressBtn.addEventListener('click', async () => {
      if (!selectedFile) return;
      const levelValue = document.querySelector('input[name="level"]:checked').value;

      try {
        compressBtn.disabled = true;
        loading.classList.add('show');
        results.classList.remove('show');
        logContainer.classList.add('show');
        clearLogs();

        addLog(`üöÄ Starting compression with ${levelValue} level`, 'info');
        await forceUIUpdate();

        const buffer = await selectedFile.arrayBuffer();
        const uint8Array = new Uint8Array(buffer);

        addLog(`‚úì PDF loaded: ${formatBytes(buffer.byteLength)}`, 'success');
        updateProgress(10, 'PDF loaded');
        await forceUIUpdate();

        const startTime = performance.now();
        compressedData = await compressWithWorkers(uint8Array, levelValue);
        const endTime = performance.now();

        addLog('üéâ Compression complete!', 'success');
        await forceUIUpdate();

        const originalSize = uint8Array.length;
        const compressedSize = compressedData.length;
        const reduction = (1.0 - (compressedSize / originalSize)) * 100;
        const savedBytes = originalSize - compressedSize;

        document.getElementById('originalSize').textContent = formatBytes(originalSize);
        document.getElementById('compressedSize').textContent = formatBytes(compressedSize);
        document.getElementById('reduction').textContent = `${reduction.toFixed(2)}% (${formatBytes(savedBytes)})`;
        document.getElementById('time').textContent = `${(endTime - startTime).toFixed(2)} ms`;

        loading.classList.remove('show');
        results.classList.add('show');
        compressBtn.disabled = false;

        addLog(`üíæ Saved ${formatBytes(savedBytes)} (${reduction.toFixed(1)}%)`, 'success');
      } catch (error) {
        addLog(`‚ùå Error: ${error}`, 'error');
        loading.classList.remove('show');
        compressBtn.disabled = false;
      }
    });

    async function compressWithWorkers(uint8Array, levelValue) {
      try {
        addLog('üì¶ Extracting JPEG images...', 'info');
        await forceUIUpdate();

        const images = extract_images(uint8Array);
        if (!images || images.length === 0) {
          addLog('‚ÑπÔ∏è No JPEG images found in PDF', 'info');
          return uint8Array;
        }

        addLog(`‚úì Found ${images.length} JPEG images`, 'success');
        await forceUIUpdate();

        const quality = levelValue === 'light' ? 85 : levelValue === 'medium' ? 70 : 55;
        const scaleFactor = levelValue === 'light' ? 0.85 : levelValue === 'medium' ? 0.65 : 0.45;

        addLog('üîÑ Compressing images in parallel...', 'info');
        await forceUIUpdate();

        const compressedImages = await compressImagesInParallel(images, quality, scaleFactor);
        const totalSaved = compressedImages.reduce((sum, img) => sum + ((img.original_size || 0) - (img.compressed_size || 0)), 0);

        addLog(`‚úì Compressed ${compressedImages.length} images, saved ${Math.round(totalSaved / 1024)} KB`, 'success');
        document.getElementById('imagesProcessed').textContent = compressedImages.length;
        await forceUIUpdate();

        addLog('üì• Reinjecting compressed images...', 'info');
        await forceUIUpdate();

        const result = reinject_images(uint8Array, compressedImages);
        addLog('‚úì PDF reinjection complete', 'success');
        return result;
      } catch (error) {
        addLog(`‚ö†Ô∏è Worker compression failed: ${error}`, 'warning');
        throw error;
      }
    }

    async function compressImagesInParallel(images, quality, scaleFactor) {
      const numWorkers = Math.min(navigator.hardwareConcurrency || 4, images.length, 8);
      const chunkSize = Math.ceil(images.length / numWorkers);
      addLog(`üìä Using ${numWorkers} workers for ${images.length} images`, 'info');
      await forceUIUpdate();

      const promises = [];
      for (let i = 0; i < numWorkers; i++) {
        const chunk = images.slice(i * chunkSize, (i + 1) * chunkSize);
        if (chunk.length === 0) continue;
        promises.push(compressChunkInWorker(chunk, i, quality, scaleFactor));
      }
      const results = await Promise.all(promises);
      return results.flat();
    }

    function compressChunkInWorker(images, workerId, quality, scaleFactor) {
      return new Promise((resolve, reject) => {
        let worker;
        try {
          worker = new Worker('./image-worker.js');
        } catch {
          const workerCode = `
            self.onmessage = async function(e) {
              const { images, quality, scaleFactor, workerId } = e.data;
              const compressed = [];
              try {
                for (let i = 0; i < images.length; i++) {
                  const img = images[i];
                  try {
                    const blob = new Blob([new Uint8Array(img.data)], { type: 'image/jpeg' });
                    const imageBitmap = await createImageBitmap(blob);
                    const newWidth = Math.max(100, Math.floor(imageBitmap.width * scaleFactor));
                    const newHeight = Math.max(100, Math.floor(imageBitmap.height * scaleFactor));
                    const canvas = new OffscreenCanvas(newWidth, newHeight);
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(imageBitmap, 0, 0, newWidth, newHeight);
                    const compressedBlob = await canvas.convertToBlob({ type: 'image/jpeg', quality: quality / 100 });
                    const arrayBuffer = await compressedBlob.arrayBuffer();
                    const uint8Array = new Uint8Array(arrayBuffer);
                    compressed.push({
                      object_id: img.object_id,
                      data: Array.from(uint8Array),
                      width: newWidth,
                      height: newHeight,
                      original_size: img.data.length,
                      compressed_size: uint8Array.length
                    });
                    self.postMessage({ type: 'progress', workerId, current: i + 1, total: images.length, saved: img.data.length - uint8Array.length });
                  } catch (error) {
                    compressed.push({ object_id: img.object_id, data: img.data, width: img.width, height: img.height, original_size: img.data.length, compressed_size: img.data.length });
                  }
                }
                self.postMessage({ type: 'complete', workerId, compressed, totalSaved: compressed.reduce((sum, img) => sum + (img.original_size - img.compressed_size), 0) });
              } catch (error) {
                self.postMessage({ type: 'error', workerId, error: error.message });
              }
            };
          `;
          const blob = new Blob([workerCode], { type: 'application/javascript' });
          worker = new Worker(URL.createObjectURL(blob));
        }

        let savedBytes = 0;
        worker.onmessage = (e) => {
          if (e.data.type === 'progress') {
            savedBytes += e.data.saved || 0;
            if (e.data.current % 5 === 0 || e.data.current === e.data.total) {
              addLog(`üîß Worker ${workerId}: ${e.data.current}/${e.data.total} images (${Math.round(savedBytes / 1024)} KB saved)`, 'success');
            }
          } else if (e.data.type === 'complete') {
            addLog(`‚úì Worker ${workerId}: ${e.data.compressed.length} images, ${Math.round(e.data.totalSaved / 1024)} KB saved`, 'success');
            worker.terminate();
            resolve(e.data.compressed);
          } else if (e.data.type === 'error') {
            addLog(`‚ùå Worker ${workerId} error: ${e.data.error}`, 'error');
            worker.terminate();
            reject(new Error(e.data.error));
          }
        };
        worker.onerror = (error) => {
          addLog(`‚ùå Worker ${workerId} crashed`, 'error');
          worker.terminate();
          reject(error);
        };
        worker.postMessage({ images, quality, scaleFactor, workerId });
      });
    }

    downloadBtn.addEventListener('click', () => {
      if (!compressedData) return;
      const levelValue = document.querySelector('input[name="level"]:checked').value;
      const blob = new Blob([compressedData], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `compressed_${levelValue}_${selectedFile.name}`;
      a.click();
      URL.revokeObjectURL(url);
    });

    function formatBytes(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
  </script>
</body>
</html>
